version: '3'

services:
  user-frontend:
    container_name: user-frontend
    image: user-frontend
    build:
      context: ./user-frontend
      dockerfile: Dockerfile
    ports:
      - 4000:3000 
    depends_on:
      - backend

  admin-frontend:
    container_name: admin-frontend
    image: admin-frontend
    build:
      context: ./admin-frontend
      dockerfile: Dockerfile
    ports:
      - 4100:3000
    depends_on:
      - backend

  backend:
    container_name: backend
    image: backend
    build: 
      context: ./backend
      dockerfile: Dockerfile
    ports:
      - 5000:4000
    depends_on:
      db:
        condition: service_healthy

  db:
    image: postgres:16-alpine
    restart: always
    environment:
      POSTGRES_PASSWORD: '${POSTGRES_PASSWORD:-postgres}' 
      POSTGRES_DB: '${POSTGRES_DB:-cinema}'
      POSTGRES_USER: '${POSTGRES_USER:-postgres}'
    healthcheck:
      test: 
        - CMD-SHELL
        - pg_isready
      interval: 1s
      timeout: 5s
      retries: 10
    volumes:
      - 'pgdata:/var/lib/postgresql/data'
volumes:
  pgdata:
    driver: local


